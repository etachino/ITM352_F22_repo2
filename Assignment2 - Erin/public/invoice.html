<script src="./product_data.js"></script>
<link href="invoice-style.css" rel="stylesheet">



<script>

      function isNonNegInt(queryString, returnErrors = false) { 
        errors = []; // assume no errors at first
        if (Number(queryString) != queryString) {
            errors.push('Not a number!'); // Check if string is a number value
        } else {
            if (queryString < 0) errors.push('Negative value!'); // Check if it is non-negative
            if (parseInt(queryString) != queryString) errors.push('Not an integer!'); // Check that it is an integer
            if (queryString == 0 && queryString == '') errors.push('Enter valid quantity'); //Returns error if no quantity is entered
        }
        if (returnErrors) {
            return errors;
        } else if (errors.length == 0) {
            return true;
        } else {
            return false;
        }
    }   

function generate_item_rows(product_quantities_array){ //generates table item rows 
for(i=0; i<product_quantities_array.length; i++){
if(quantities[i]==0){
  continue;
}  
errorArray = isNonNegInt(quantities[i], true);
  if(errors.length==0){
    extended_price = product_quantities_array[i] * products[i].price;
    (subtotal += extended_price)
  } else {extended_price=0}
  

document.write(`
      <tr>
        <td width="43%"><img src="/images/${products[i].image}" style="width: 20%; height: 20%">${products[i].name}</td>
        <td align="center" width="11%">${quantities[i]}</div></td>
        <td width="13%">\$${products[i].price}</td>
        <td width="54%">\$${extended_price}</td>
      </tr>
      `);
}
}
// Compute Subtotal
var subtotal = 0;
</script>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Document</title>
</head>
<script>
params = (new URL(document.location)).searchParams;
var quantities= [];
for(i=0; i<products.length; i++) {
if(quantities[i] = params.get(`quantity${i}`)){
} else{ quantities[i] = 0;
}
}
</script>
<body onload="CustomizeInvoice()">
<center><h1> Products You Purchased!</h1></center>
<span class="name" id="name"></span> <br>
<span class="email" id="email"></span><br>
  <span class="date" id="date"></span><br>
    <span class="LogCount" id="LogCount"></span>
<table border="2">
    <tbody>
      <tr>
        <th style="text-align: center;" width="43%">Item</th>
        <th style="text-align: center;" width="11%">quantity</th>
        <th style="text-align: center;" width="13%">price</th>
        <th style="text-align: center;" width="54%">extended price</th>
      </tr>
      <script>
        generate_item_rows(quantities); {

        };
  
        //write user's name and email address in the invoice
  function CustomizeInvoice(){
  if(params.has("email")){
    document.getElementById("email").innerHTML = "Email: " + params.get('email');
    console.log(params.get('email'));
  } if(params.has("name")){
    document.getElementById("name").innerHTML = "Welcome " + params.get('name') + "!";
    console.log(params.get('name'))
  } if(params.has(`quantity${i}`)) {
    document.getElementByID("date").innerhtml = Date();
    console.log(Date());
  } if(params.has("LogCount")){
    document.getElementById("LogCount").innerHTML = "Times Logged In: " + params.get('LogCount');
  }

  }
  

// Computer Tax
var tax_rate = 0.0575;
var tax = tax_rate*subtotal;

// Computer Shipping 
if(subtotal <= 50) (
  shipping =2
)
else if(subtotal <= 100)(
  shipping = 5
)
else (
  shipping = 0.05*subtotal
)

// Computer Grand total
var total = subtotal + tax + shipping;
    </script>
      <tr>
        <td colspan="4" width="100%">&nbsp;</td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
        <td width="54%">$<script>document.write(subtotal);</script></td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%"><span style="font-family: arial;">Tax @ <script>document.write(100*tax_rate);</script>%</span></td>
        <td width="54%">$<script>document.write(tax.toFixed(2));</script></td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">Shipping<span style="font-family: arial;">
        <td width="54%">$<script>document.write(shipping.toFixed(2));</script></td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%"><strong>Total</strong></td>
        <td width="54%"><strong>$<script>document.write(total.toFixed(2));</script></strong></td>
      </tr>
    </tbody>
  </table> 
  <div style = "font-weight: bold;">
    OUR SHIPPING POLICY IS:A subtotal $0 - $49.99 will be $2 shipping
    <br>
  A subtotal $50 - $99.99 will be $5 shipping
  <br>
Subtotals over $100 will be charged 5% of the subtotal amount
  </div>
</body>
<footer>
<center><button onclick="window.location='products_display.html';">Logout</button></center>
<center><button onclick="location.href=`user_update.html?${params.toString()}`;">Edit Credentials</button></center>
</footer>
</html>