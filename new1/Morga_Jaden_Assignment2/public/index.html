<!--
Jaden Morga
Oct 17 2022
This code creates the website user interface that will allow customers to show and guide them to enter valid quantities in order for purchase
-->
<script src="./products.js" type="text/javascript">
    //Link html file to my array

</script>

<script>
    let params = (new URL(document.location)).searchParams;


    // When the window loads, perform the following function:
    window.onload = function () {
        // If the url has 'inputError', it means that there is a negative, non-integer, or non-number value
        if (params.has('inputError')) {
            // Make an alert with the value of key: inputError, which is "Please correct all errors"
            alert(params.get('inputError'));
            for (let i in products) {
                // Display the error message in the label
                document.getElementById(`quantity${i}_label`).innerHTML = params.get(`q_error${i}`);
                // Display what the user inputted in the value of the input box by getting the value from the URL that matches with key 'quantity${i}'
                inputForm[`qInput${i}`].value = params.get(`quantity${i}`);
            }
        }
        // If the url has the key 'noQuantities', it means that there are no quantities inputted
        // If so, send an alert with the value 'Please enter a quantity'
        if (params.has('noQuantities')) {
            alert(params.get('noQuantities'));
        }
    }

    //This code displays my website which includes textboxes that customers can fill out. The code below creates which quantitees are valid to go through to the invoice
    // Checking to see if inbox has valid quantities and to add pop ups to inform customers 
    function checkQuantityTextbox(theTextbox) {
        console.log("in checkbox", theTextbox.name);

        // Setting all errors to isNonNegInt
        errors = isNonNegInt(theTextbox.value, true);
        //Will Display if input is 0
        if (errors.length == 0) errors = ['Enter your quantity desired: '];
        //Will display if input is blank
        if (theTextbox.value.trim() == '') errors = ['Enter your quantity desired: '];
        //Will display errors in red font
        if (errors.length > 0) {
            document.getElementById(theTextbox.name + '_label').innerHTML = errors.join('<font color="red">, </font>');
        }
    }
    //Code Referenced from Lab 11 Ex 5
    function isNonNegInt(arrayElement, returnErrors = false) {
        errors = []; // assume no errors at first
        if (Number(arrayElement) != arrayElement) errors.push('<font color="red">Not a number!</font>'); // Check if string is a number value
        else {
            if (arrayElement < 0) errors.push('<font color="red">Quantity cannot be a negative!</font>');
            // Checking if input is an integer; // Check if it is non-negative
            if (parseInt(arrayElement) != arrayElement) errors.push('<font color="red">Not an integer!</font>'); // Check that it is an integer
            if ((parseInt(arrayElement) == arrayElement) && (arrayElement >= 0)) { // Check that it is a positive integer
                // Loop through the products array
                for (let i = 0; i < products.length; i++) {
                    // Set user input ID
                    var inputValue = document.getElementById(`qInput${i}`).value;
                    //IR3 (When user inputs quantity higher than what is available)
                    if ((inputValue > 0) && (inputValue > products[i].quantity_available)) {
                        // Push the error message
                        errors.push(`We do not have ${arrayElement} available.`);
                        // Calculate the difference between the amount inputted and inventory amount
                        var extra = arrayElement - products[i].quantity_available;
                        document.getElementById(`qInput${i}`).value = arrayElement - extra;
                        // Show oupt in red
                        document.getElementById(`quantity${i}_label`).style.color = "red";

                    }
                }
            }
        }
        return (returnErrors ? errors : (errors.length == 0));
    };
</script>
<!DOCTYPE html>
<html>

<head>
    <!-- author: ww3 schools -->
    <title>The Plant Collective</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="products-style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
    <style>
        body,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: "Karma", sans-serif
        }

        .w3-bar-block .w3-bar-item {
            padding: 20px
        }
    </style>
</head>

<body>



    <!-- Top menu -->
    <div class="w3-top">
        <!-- Sidebar (hidden by default) -->
        <nav class="w3-sidebar w3-bar-block w3-card w3-top w3-xlarge w3-animate-left"
            style="display:none;z-index:2;width:40%;min-width:200px" id="mySidebar">
            <a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button">Close Menu</a>
        </nav>
        <div class="w3-white w3-xlarge" style="max-width:1200px;margin:auto">
            <div class="w3-button w3-padding-16 w3-left" onclick="w3_open()">â˜°</div>
            <div class="w3-center w3-padding-16">The Plant Collective &#127793</div>
        </div>
    </div>

    <form action="process_form" method="POST" id="inputForm">
        <main>

            <script>
                // Loop displays the products arrays with the follwoing information: name, quantity, price and image
                //Code referenced from Store 1 WOD & modified to work wi
                
                for (let i = 0; i < products.length; i++) {

document.write(`
        <div class="w3-third">
            <img src="${products[i].image}">
            <h2>${products[i].name}</h2>
            <p>$${products[i].price}</p>
            <h3>${products[i].quantity_available} avaliable</h3>
            <h3>${products[i].total_sold} sold</h3>
            <div style="width:80%; margin-left:10%;">
                <label id="quantity${i}_label"}" style="font-size: 13px;">Quantity</label>
                <span><input style="width:30px;" type="text" placeholder="0" name="quantity${i}" id="qInput${i}"  onchange="checkQuantityTextbox(this)"> 
            </div>
        </div>
        <br>
    
`);

}

</script>
</script>
</main></div>

<div class="container">
    <div class="center">
        <br><input type="submit" class="button" value="Purchase" id="submit" name="purchase_submit">
    </div>
</div>

</form>

</body>
</html>